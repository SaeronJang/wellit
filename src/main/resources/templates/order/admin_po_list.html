<html layout:decorate="~{manager/manager_layout}">
<div layout:fragment="tabcontent" >
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
	      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
	        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
	        crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
	        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
	        crossorigin="anonymous"></script>
	<link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic.css" rel="stylesheet">
	<link rel="stylesheet"
	      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"/>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=28da3dbc8c389b574e0c32075b4e02ba"></script>
	<link rel="stylesheet" href="/css/layout.css"/>
	
	
	
	
	<!-- 제이쿼리 라이브러리 로드 -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	
	
	<!--swiper cdn-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
	<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
	
	
	<!--order style link-->
	<link rel="stylesheet" th:href="@{/css/order.css}">
	
	<!--order js link-->
	<script src="/js/order.js"></script>


<div class="d-flex flex-column min-vh-100" id="wrapper">
	
<!--	<div layout:fragment="content" class="container">-->
		
		
		
		<!--페이지 제목-->
		<div class="row my-5">
			<div class="pageTitle col text-center">
				주문 처리
			</div>
		</div>
		
		<section class="row vstack orderItem position-relative mb-5">
			
			<p class="subtle f18 c666 fw-bold">
				주문 내역
			</p>
			
			<div class="col gap-3 g-3">
				<!-- 검색 및 필터 기능 -->
				<form class="mb-3 d-flex" id="searchForm">
					<input type="text" id="searchInput" class="form-control me-2" placeholder="Search by Order ID" name="search">
					<select class="form-select me-2" id="statusSelect" name="status">
						<option value="">All Statuses</option>
						<option value="CREATED">Created</option>
						<option value="PAID">Paid</option>
						<option value="SHIPPED">Shipped</option>
						<option value="DELIVERED">Delivered</option>
						<option value="CANCELLED">Cancelled</option>
					</select>
					<button type="button" class="btn btn-primary" onclick="fetchOrders()">Search</button>
				</form>
				
				<!-- 주문 목록 테이블 -->
				<table class="table table-hover" id="orderTable">
					<thead>
					<tr>
						<th scope="col">Order Date</th>
						<th scope="col">Order ID</th>
						<th scope="col">Customer Name</th>
						<th scope="col">Status</th>
						<th scope="col">Total Payment</th>
						<th scope="col">Actions</th>
					</tr>
					</thead>
					<tbody id="orderTableBody">
					<!-- Fetch로 받은 데이터를 여기에 렌더링 -->
					</tbody>
				</table>
				
				
				
			</div> <!-- //col -->
		
			
			<script th:inline="javascript">

          document.addEventListener("DOMContentLoaded", function () {
              fetchOrders(); // 페이지 로드 시 주문 목록 불러오기
          });

          async function fetchOrders() {
              // 검색어와 상태 필터 값 가져오기
              const search = document.getElementById("searchInput").value;
              const status = document.getElementById("statusSelect").value;

              // Fetch API를 사용하여 서버에서 데이터 가져오기
              const response = await fetch(`/api/orders?search=${search}&status=${status}`);
              const data = await response.json();

              // 테이블에 주문 목록 렌더링
              const orderTableBody = document.getElementById("orderTableBody");
              orderTableBody.innerHTML = ""; // 기존 내용 제거

              data.orders.forEach(order => {
                  const row = `<tr>
                <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                <td>${order.orderId}</td>
                <td>${order.memberName}</td>
                <td>${order.status}</td>
                <td>${order.totalPay}</td>
                <td>
                    <a href="/order/admin/po/${order.orderId}" class="btn btn-info btn-sm">View</a>
                    ${order.status !== 'CANCELLED' ? `<a href="/order/cancel/${order.orderId}" class="btn btn-danger btn-sm">Cancel</a>` : ''}
                </td>
            </tr>`;
                  orderTableBody.insertAdjacentHTML('beforeend', row);
              });
          }

          <!-- 주문 상세 정보 비동기 불러오기 -->
          async function viewOrderItems(orderId) {
              try {
                  const response = await fetch(`/api/orders/${orderId}`);
                  if (!response.ok) {
                      throw new Error('Failed to load order details');
                  }
                  const data = await response.text();

                  // 데이터를 하단의 주문 상세 섹션에 표시
                  document.getElementById('orderDetailsSection').innerHTML = data;
                  document.getElementById('orderDetailsSection').style.display = 'block';
              } catch (error) {
                  alert(error.message);
              }
          }
			
			</script>
		
		</section> <!--		//orderItem-->
	<!--</div>--> <!-- //content container -->

</div><!-- // #wrapper -->
<!--daum 주소 입력 api-->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<!--order js link-->
<script src="/js/order.js"></script>

</div>
</html>